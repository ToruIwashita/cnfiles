#! /bin/bash

## dir,path
__FILE__=$_
BASE_DIR_PATH=${__FILE__%/./*}
WORKING_DIR_PATH=$PWD
echo $BASE_DIR_PATH

# base dir,path
ZSH_DIR=zsh.d
PECO_DIR=peco
CACHE_DIR=cache
ZSH_DIR_PATH=~/.$ZSH_DIR
PECO_DIR_PATH=~/.$PECO_DIR
CACHE_DIR_PATH=~/.$CACHE_DIR

# src dir,path
SRC_DIR_PATH=~/src
LOCAL_DIR_PATH=~/local
ZSH_SRC_DIR_PATH=$SRC_DIR_PATH/zsh
VIM_SRC_DIR_PATH=$SRC_DIR_PATH/vim
TMUX_SRC_DIR_PATH=$SRC_DIR_PATH/tmux
GIT_SRC_DIR_PATH=$SRC_DIR_PATH/git
LUAJIT_SRC_DIR_PATH=$SRC_DIR_PATH/luajit
CTAGS_SRC_DIR_PATH=$SRC_DIR_PATH/ctags
SILVER_SEARCHER_SRC_DIR_PATH=$SRC_DIR_PATH/silver_searcher
NEOVIM_SRC_DIR_PATH=$SRC_DIR_PATH/neovim  # 使用していない

# plugin dir,path
ZSH_COMPLETIONS_DIR_PATH=$ZSH_DIR_PATH/plugin/zsh-completions
ZSH_HISTORY_SUBSTRING_SEARCH_DIR_PATH=$ZSH_DIR_PATH/plugin/zsh-history-substring-search

# repositories
ZSH_REPOSITORY='git://github.com/zsh-users/zsh'
VIM_REPOSITORY='git://github.com/vim-jp/vim'
TMUX_REPOSITORY='git://git.code.sf.net/p/tmux/tmux-code'
GIT_REPOSITORY='git://github.com/gitster/git'
LUAJIT_REPOSITORY='http://luajit.org/git/luajit-2.0.git'
CTAGS_REPOSITORY='git://github.com/fishman/ctags'
SILVER_SEARCHER_REPOSITORY='git://github.com/ggreer/the_silver_searcher'
ZSH_COMPLETIONS_REPOSITORY='git://github.com/zsh-users/zsh-completions'
ZSH_HISTORY_SUBSTRING_SEARCH_REPOSITORY='git://github.com/zsh-users/zsh-history-substring-search'
NEOBUNDLE_REPOSITORY='git://github.com/Shougo/neobundle.vim'
NEOVIM_REPOSITORY='git://github.com/neovim/neovim'  # 使用していない

## init
# source or local
[[ -d $SRC_DIR_PATH ]]                          || mkdir $SRC_DIR_PATH
[[ -d $LOCAL_DIR_PATH ]]                        || mkdir $LOCAL_DIR_PATH
[[ -d $ZSH_SRC_DIR_PATH ]]                      || git clone $ZSH_REPOSITORY $ZSH_SRC_DIR_PATH
[[ -d $VIM_SRC_DIR_PATH ]]                      || git clone $VIM_REPOSITORY $VIM_SRC_DIR_PATH
[[ -d $TMUX_SRC_DIR_PATH ]]                     || git clone $TMUX_REPOSITORY $TMUX_SRC_DIR_PATH
[[ -d $GIT_SRC_DIR_PATH ]]                      || git clone $GIT_REPOSITORY $GIT_SRC_DIR_PATH
[[ -d $LUAJIT_SRC_DIR_PATH ]]                   || git clone $LUAJIT_REPOSITORY $LUAJIT_SRC_DIR_PATH
[[ -d $CTAGS_SRC_DIR_PATH ]]                    || git clone $CTAGS_REPOSITORY $CTAGS_SRC_DIR_PATH
[[ -d $SILVER_SEARCHER_SRC_DIR_PATH ]]          || git clone $SILVER_SEARCHER_REPOSITORY $SILVER_SEARCHER_SRC_DIR_PATH
[[ -d $NEOVIM_SRC_DIR_PATH ]]                   || git clone $NEOVIM_REPOSITORY $NEOVIM_SRC_DIR_PATH  # 使用していない
# cache dir
[[ -d $CACHE_DIR_PATH ]]                        || mkdir $CACHE_DIR_PATH
[[ -d $CACHE_DIR_PATH/yankring ]]               || mkdir $CACHE_DIR_PATH/yankring
# peco dir
[[ -d $PECO_DIR_PATH ]]                         || mkdir $PECO_DIR_PATH
# zsh
[[ -d $ZSH_DIR_PATH ]]                          || mkdir $ZSH_DIR_PATH
[[ -f $ZSH_DIR_PATH/config.zsh ]]               || touch $ZSH_DIR_PATH/config.zsh
[[ -f $ZSH_DIR_PATH/config.local.zsh ]]         || touch $ZSH_DIR_PATH/config.local.zsh
[[ -d $ZSH_DIR_PATH/functions ]]                || mkdir $ZSH_DIR_PATH/functions
[[ -d $ZSH_DIR_PATH/completions ]]              || mkdir $ZSH_DIR_PATH/completions
[[ -d $ZSH_DIR_PATH/widgets ]]                  || mkdir $ZSH_DIR_PATH/widgets
[[ -d $ZSH_DIR_PATH/local ]]                    || mkdir $ZSH_DIR_PATH/local
[[ -d $ZSH_DIR_PATH/local/functions ]]          || mkdir $ZSH_DIR_PATH/local/functions
[[ -d $ZSH_DIR_PATH/local/completions ]]        || mkdir $ZSH_DIR_PATH/local/completions
[[ -d $ZSH_DIR_PATH/plugin ]]                   || mkdir $ZSH_DIR_PATH/plugin
[[ -d $ZSH_COMPLETIONS_DIR_PATH ]]              || git clone $ZSH_COMPLETIONS_REPOSITORY $ZSH_COMPLETIONS_DIR_PATH
[[ -d $ZSH_HISTORY_SUBSTRING_SEARCH_DIR_PATH ]] || git clone $ZSH_HISTORY_SUBSTRING_SEARCH_REPOSITORY $ZSH_HISTORY_SUBSTRING_SEARCH_DIR_PATH

## update source files
printf "### git pull zsh src.\n"
cd $ZSH_SRC_DIR_PATH && git pull
printf "### git pull vim src.\n"
cd $VIM_SRC_DIR_PATH && git pull
printf "### git pull tmux src.\n"
cd $TMUX_SRC_DIR_PATH && git pull
printf "### git pull git src.\n"
cd $GIT_SRC_DIR_PATH && git pull
printf "### git pull luajit src.\n"
cd $LUAJIT_SRC_DIR_PATH && git pull
printf "### git pull ctags src.\n"
cd $CTAGS_SRC_DIR_PATH && git pull
printf "### git pull silver_searcher src.\n"
cd $SILVER_SEARCHER_SRC_DIR_PATH && git pull
printf "### git pull zsh-completions.\n"
cd $ZSH_COMPLETIONS_DIR_PATH && git pull
printf "### git pull zsh-history-substring-search\n"
cd $ZSH_HISTORY_SUBSTRING_SEARCH_DIR_PATH && git pull
printf "### git pull neovim src.\n"
cd $NEOVIM_SRC_DIR_PATH && git pull  # 使用していない

### copy files
cd $BASE_DIR_PATH
# zsh
printf "### copy zsh main configs.\n"
\cp -p $BASE_DIR_PATH/zshrc               ~/.zshrc
\cp -p $BASE_DIR_PATH/$ZSH_DIR/config.zsh $ZSH_DIR_PATH/config.zsh
# vim
printf "### create symlink vim.\n"
ln -sf $BASE_DIR_PATH/vimrc ~/.vimrc
ln -sf $BASE_DIR_PATH/vim ~/.vim
# tmux
printf "### copy tmux config.\n"
\cp -p $BASE_DIR_PATH/tmux.conf ~/.tmux.conf
# peco
printf "### copy peco config.\n"
\cp -p $BASE_DIR_PATH/peco.config.json $PECO_DIR_PATH/config.json
# pry
printf "### copy pry config.\n"
\cp -p $BASE_DIR_PATH/pryrc ~/.pryrc

# zsh,vim
printf "### copy zsh or vim functions, and other files.\n"
source_directories=(
  $ZSH_DIR/functions
  $ZSH_DIR/completions
  $ZSH_DIR/widgets
)
for dir in ${source_directories[@]}; do
  for file in `ls $BASE_DIR_PATH/${dir}`; do
    \cp -p $BASE_DIR_PATH/${dir}/${file} ~/.${dir}/${file}
  done
done

cd $WORKING_DIR_PATH
printf "### sync complete.\n"

# restart
exec zsh
