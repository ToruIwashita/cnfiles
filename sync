#! /bin/sh

## dir,path
__FILE__=$_
BASE_DIR_PATH=${__FILE__%/*}
WORKING_DIR_PATH=$(pwd)

ZSH_DIR=zsh.d
VIM_DIR=vim
ZSH_DIR_PATH=~/.$ZSH_DIR
VIM_DIR_PATH=~/.$VIM_DIR

SRC_DIR_PATH=~/src
LOCAL_DIR_PATH=~/local
ZSH_SRC_DIR_PATH=$SRC_DIR_PATH/zsh
VIM_SRC_DIR_PATH=$SRC_DIR_PATH/vim
LUAJIT_SRC_DIR_PATH=$SRC_DIR_PATH/luajit

ZSH_REPOSITORY="git://github.com/zsh-users/zsh"
VIM_REPOSITORY="git://github.com/vim-jp/vim"
NEOBUNDLE_REPOSITORY="git://github.com/Shougo/neobundle.vim"
LUAJIT_REPOSITORY="http://luajit.org/git/luajit-2.0.git"

## init
# source or local
[ -d $SRC_DIR_PATH ]                      || mkdir $SRC_DIR_PATH
[ -d $LOCAL_DIR_PATH ]                    || mkdir $LOCAL_DIR_PATH
[ -d $ZSH_SRC_DIR_PATH ]                  || git clone $ZSH_REPOSITORY $ZSH_SRC_DIR_PATH
[ -d $VIM_SRC_DIR_PATH ]                  || git clone $VIM_REPOSITORY $VIM_SRC_DIR_PATH
[ -d $LUAJIT_SRC_DIR_PATH ]               || git clone $LUAJIT_REPOSITORY $LUAJIT_SRC_DIR_PATH
# zsh
[ -d $ZSH_DIR_PATH ]                      || mkdir $ZSH_DIR_PATH
[ -f $ZSH_DIR_PATH/config ]               || touch $ZSH_DIR_PATH/config
[ -f $ZSH_DIR_PATH/config.local ]         || touch $ZSH_DIR_PATH/config.local
[ -d $ZSH_DIR_PATH/lib ]                  || mkdir $ZSH_DIR_PATH/lib
[ -d $ZSH_DIR_PATH/completion ]           || mkdir $ZSH_DIR_PATH/completion
[ -d $ZSH_DIR_PATH/local ]                || mkdir $ZSH_DIR_PATH/local
[ -d $ZSH_DIR_PATH/local/lib ]            || mkdir $ZSH_DIR_PATH/local/lib
[ -d $ZSH_DIR_PATH/local/completion ]     || mkdir $ZSH_DIR_PATH/local/completion
# vim
[ -d $VIM_DIR_PATH ]                      || mkdir $VIM_DIR_PATH
[ -f $VIM_DIR_PATH/config ]               || touch $VIM_DIR_PATH/config
[ -f $VIM_DIR_PATH/config.plugin ]        || touch $VIM_DIR_PATH/config.plugin
[ -f $VIM_DIR_PATH/autocommand ]          || touch $VIM_DIR_PATH/autocommand
[ -d $VIM_DIR_PATH/vfunc ]                || mkdir $VIM_DIR_PATH/vfunc
[ -d $VIM_DIR_PATH/abbreviate ]           || mkdir $VIM_DIR_PATH/abbreviate
[ -d $VIM_DIR_PATH/macro ]                || mkdir $VIM_DIR_PATH/macro
[ -d $VIM_DIR_PATH/bundle ]               || mkdir $VIM_DIR_PATH/bundle
[ -d $VIM_DIR_PATH/bundle/neobundle.vim ] || git clone $NEOBUNDLE_REPOSITORY $VIM_DIR_PATH/bundle/neobundle.vim

## update zsh,vim,lua source
echo "git pull zsh src."
cd $ZSH_SRC_DIR_PATH && git pull
echo "git pull vim src."
cd $VIM_SRC_DIR_PATH && git pull
echo "git pull luajit src."
cd $LUAJIT_SRC_DIR_PATH && git pull

## copy files
cd $BASE_DIR_PATH
# zsh
echo "copy zsh main configs."
\cp -p $BASE_DIR_PATH/zshrc           ~/.zshrc
\cp -p $BASE_DIR_PATH/$ZSH_DIR/config $ZSH_DIR_PATH/config
# vim
echo "copy vim main configs."
\cp -p $BASE_DIR_PATH/vimrc                  ~/.vimrc
\cp -p $BASE_DIR_PATH/$VIM_DIR/config        $VIM_DIR_PATH/config
\cp -p $BASE_DIR_PATH/$VIM_DIR/config.plugin $VIM_DIR_PATH/config.plugin
\cp -p $BASE_DIR_PATH/$VIM_DIR/autocommand   $VIM_DIR_PATH/autocommand
# tmux
echo "copy tmux config."
\cp -p $BASE_DIR_PATH/tmux.conf ~/.tmux.conf

# zsh,vim
echo "copy zsh or vim functions, and other files." 
source_directories=($ZSH_DIR/lib $ZSH_DIR/completion $VIM_DIR/vfunc $VIM_DIR/abbreviate $VIM_DIR/macro)
for dir in ${source_directories[@]}; do
  for file in `ls $BASE_DIR_PATH/${dir}`; do
    \cp -p $BASE_DIR_PATH/${dir}/${file} ~/.${dir}/${file}
  done
done

cd $WORKING_DIR_PATH
echo "sync complete."

# restart
exec zsh
