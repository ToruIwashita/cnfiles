# CLAUDE.md

このファイルは Claude Code (claude.ai/code) がこのリポジトリで作業する際のガイダンスを提供します

## 🚨 必須実行順序

**重要 - 全ての会話で必ず従うこと**:

### 1. 実装ガイド確認（最優先）
コード作業を開始する前に Claude は必ずタスクが Vim または Zsh に関連するかチェックする必要があります：

**Vim関連タスクの場合:**
1. 即座に実行: `echo $MARKDOWN_TEXTS_VIM_IMPLEMENTATION_GUIDE_FILE_PATH`
2. 即座にReadツールで返されたファイルパスを読み込み
3. 作業全体を通じて実装ガイドのガイドラインを適用

**Zsh関連タスクの場合:**
1. 即座に実行: `echo $MARKDOWN_TEXTS_ZSH_IMPLEMENTATION_GUIDE_FILE_PATH`
2. 即座にReadツールで返されたファイルパスを読み込み
3. 作業全体を通じて実装ガイドのガイドラインを適用

**実装ガイド使用方法:**
- `$MARKDOWN_TEXTS_VIM_IMPLEMENTATION_GUIDE_FILE_PATH` - Vim実装のベストプラクティスとガイドライン
- `$MARKDOWN_TEXTS_ZSH_IMPLEMENTATION_GUIDE_FILE_PATH` - Zsh関数実装のベストプラクティスとガイドライン

**作業検出基準:**
- **Zsh作業**: `zsh.d/` ディレクトリ内のファイル, `.zsh` で終わるファイル, シェル関数の実装, Zsh補完関数, 全てのシェルスクリプト作業
- **Vim作業**: `vim/` ディレクトリ内のファイル, `.vim` または `.vimrc` で終わるファイル, Vimプラグイン設定, Vimscript実装

**実装品質保証:**
- 実装ガイドで指定された「必須ルール」は絶対遵守
- コード完成時に実装ガイドとの照合を必須実行
- ルール違反は重大なエラーとして即座に修正

### 2. タスク計画（第二優先）
実装ガイドを読んだ後（該当する場合）複雑なタスクではTodoWriteツールを使用

### 3. 実行（第三優先）
該当する全てのガイドラインに従って計画された作業を実行

**強制実行**: この実行順序は必須でありいかなる状況でも回避や無視はできません この順序に従わないことは重大なエラーです

## 🌏 言語設定ルール

**必須言語設定:**
- 全ての回答は日本語で行う
- コード内のコメントも日本語で記述する
- エラーメッセージや技術的な説明も日本語で提供する
- 英語での回答は避け,常に日本語での対応を優先する
- ユーザーとのやり取りは全て日本語で統一する

## 📋 プロジェクト概要

macOS開発環境の包括的dotfiles (.cnfiles) - gitサブモジュールによるツール管理と自動化インストールスクリプト

## ⚡ 必須コマンド

### 初期セットアップ
```bash
# 開発環境全体を初期化
./scripts/init.bash

# 全gitサブモジュールを更新
git submodule update --init
```

### ツールインストール
`scripts/` 内の個別インストーラー: vim, git, tmux, zsh, asdf等

## 🏗️ アーキテクチャ

### 主要ディレクトリ
- `/modules/` - gitサブモジュール
- `/scripts/` - インストールスクリプト
- `/zsh.d/` - Zsh設定
- `/vim/` - Vim設定
- `/git/` - Git設定
- `/tmux/` - Tmux設定
- `/claude/` - Claude Code設定
- `/local/` - ローカルカスタマイゼーション

### 設定管理
- シンボリックリンク戦略
- `.local` サフィックスによるローカルオーバーライド
- `scripts/env.bash` による環境変数管理

### 言語サポート
Ruby, Python, JavaScript/TypeScript, Go, Shell環境の設定管理

## ⚙️ Claude Code設定

### 設定ファイル構造
**統合設定**: `claude/settings.json` - シンボリックリンクによる一元管理

### 権限管理
**重要**: Claude Codeがツールやファイルアクセスの権限を要求する場合：

**権限追加プロセス:**
1. 権限を求められたら許可する
2. **全ての権限**を `claude/settings.json` の `permissions.allow` 配列に追加
   - プロジェクト関連権限（リポジトリ固有のツールとワークフロー）
   - グローバル権限（個人設定, システム全体のツール）
3. **重要**: `.claude/settings.local.json` に自動追加された権限は削除し `claude/settings.json` に移動

**利点**: 一元管理とgitバージョン管理


## 🔄 ルール進化プロセス

**重要**: ユーザーが永続的な標準となるべき指示を提供した場合：

1. **認識フェーズ**: ユーザーの指示が一回限りの要求ではなく継続的な要件である場合を特定
   - ワークフローパターンに影響する指示
   - 将来の全てのやり取りに適用すべき設定
   - プロジェクト全体の一貫性を向上させる標準

2. **確認フェーズ**: ユーザーに明示的に質問：
   ```
   "これを将来の全てのやり取りにおける永続的なルールにしますか？"
   ```

3. **実装フェーズ**: ユーザーの確認（YES）時：
   - 新しいルールをこのCLAUDE.mdファイルの適切なセクションに追加
   - ルールを即座に適用し以降の全てのやり取りで使用
   - 必要に応じて具体例を含めてルールを明確に文書化

4. **適用フェーズ**:
   - 文書化された全てのルールを必須要件として扱う
   - 全てのやり取りでルールを一貫して参照
   - 明示的なユーザー指示なしに確立されたルールを無視または上書きしない

**目的**: このプロセスはユーザー設定を体系的に取得し永続的なプロジェクト標準に変換することで AIエージェントのパフォーマンスの継続的改善を保証します

## 📝 重要事項

- macOS (Darwin) 専用設計
- `.local` ファイルによるローカルカスタマイゼーション
- `~/works/memolist/` でのタスク管理

## 📋 重要指示リマインダー
求められたことを実行する；それ以上でも以下でもない
絶対に必要でない限りファイルを作成しない
新しいファイルを作成するよりも既存ファイルの編集を常に優先する
ドキュメントファイル（*.md）やREADMEファイルを積極的に作成しない
ユーザーが明示的に要求した場合のみドキュメントファイルを作成する
