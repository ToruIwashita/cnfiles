# CLAUDE.md  

このファイルは Claude Code (claude.ai/code) がこのリポジトリで作業する際のガイダンスを提供します  

## 🚨 必須実行順序  

**重要 - 全ての会話で必ず従うこと**:  

### 1. 実装ガイド確認（最優先）  
コード作業を開始する前に Claude は必ずタスクが Vim または Zsh に関連するかチェックする必要があります：  

**Vim関連タスクの場合:**  
1. 即座に実行: `echo $MARKDOWN_TEXTS_VIM_IMPLEMENTATION_GUIDE_FILE_PATH`  
2. 即座にReadツールで返されたファイルパスを読み込み  
3. 作業全体を通じて実装ガイドのガイドラインを適用  

**Zsh関連タスクの場合:**  
1. 即座に実行: `echo $MARKDOWN_TEXTS_ZSH_IMPLEMENTATION_GUIDE_FILE_PATH`  
2. 即座にReadツールで返されたファイルパスを読み込み  
3. 作業全体を通じて実装ガイドのガイドラインを適用  

**Zsh作業の検出基準:**  
- `zsh.d/` ディレクトリ内のファイル  
- `.zsh` で終わるファイル  
- シェル関数の実装  
- Zsh補完関数  
- 全てのシェルスクリプト作業  

**Vim作業の検出基準:**  
- `vim/` ディレクトリ内のファイル  
- `.vim` または `.vimrc` で終わるファイル  
- Vimプラグイン設定  
- Vimscript実装  

### 2. タスク計画（第二優先）  
実装ガイドを読んだ後（該当する場合）複雑なタスクではTodoWriteツールを使用  

### 3. 実行（第三優先）  
該当する全てのガイドラインに従って計画された作業を実行  

**強制実行**: この実行順序は必須でありいかなる状況でも回避や無視はできません この順序に従わないことは重大なエラーです  

## 📋 プロジェクト概要  

これは macOS用の完全な開発環境セットアップを管理する包括的な個人dotfilesリポジトリ(.cnfiles)です gitサブモジュールを使用して様々な開発ツールのソースコードを管理し自動化されたインストールと設定スクリプトを提供します  

## ⚡ 必須コマンド  

### 初期セットアップ  
```bash  
# 開発環境全体を初期化  
./scripts/init.bash  

# 全gitサブモジュールを更新  
git submodule update --init  
```  

### ツールインストール  
`scripts/` ディレクトリに個別のツールインストーラーが利用可能：  
- `./scripts/asdf-installer.bash` - asdfバージョンマネージャーのインストール  
- `./scripts/vim-installer.bash` - ソースからVimのコンパイルとインストール  
- `./scripts/git-installer.bash` - ソースからGitのコンパイルとインストール  
- `./scripts/tmux-installer.bash` - tmuxターミナルマルチプレクサーのインストール  
- `./scripts/zsh-installer.bash` - Zshシェルのインストール  
- 言語パッケージインストーラー: `gems-installer.bash`, `npms-installer.bash`, `pypies-installer.bash`, `go-package-installer.bash`  

## 🏗️ アーキテクチャ  

### ディレクトリ構造  
- **`/modules/`** - 開発ツールのソースコードを含むgitサブモジュール (asdf, ctags, git, vim, tmux, zsh等)  
- **`/scripts/`** - インストールとセットアップの自動化スクリプト  
- **`/zsh.d/`** - Antigenプラグイン管理による包括的なZsh設定  
- **`/vim/`** - vim-plugによる50以上のプラグインを持つ広範なVim/Neovimセットアップ  
- **`/git/`** - Git設定 (gitconfig, gitattributes, gitignore)  
- **`/config/`** - ツール固有の設定 (black, flake8, karabiner, mypy)  
- **`/tmux/`** - Tmuxターミナルマルチプレクサー設定  
- **`/claude/`** - Claude Code IDE設定  
- **`/local/`** - ローカルカスタマイゼーションとバイナリオーバーライド  

### 設定管理  
- **シンボリックリンク戦略**: initスクリプトがホームディレクトリから設定ファイルへのシンボリックリンクを作成  
- **ローカルオーバーライド**: マシン固有のカスタマイゼーションに `.local` サフィックスファイルを使用  
- **環境変数**: `scripts/env.bash` による一元化された環境設定  
- **モジュラー設計**: 各ツールが専用の設定ディレクトリを持つ  

### 言語サポート  
- **Ruby**: gem設定によるasdf管理  
- **Python**: flake8, black, mypy設定によるPythonパッケージ  
- **JavaScript/TypeScript**: ESLint設定によるnpmパッケージ  
- **Go**: delveデバッガー設定によるGoパッケージ  
- **Shell**: カスタム関数と補完による高度なZsh設定  

## ⚙️ Claude Code設定  

### 設定ファイル構造  
この環境では Claude Codeの設定は以下のように構成されています：  

**統合設定**: `claude/settings.json` (gitで追跡)  
- `~/.claude/settings.json` からこのファイルへシンボリックリンクが作成済み  
- プロジェクト固有とグローバル設定の両方を含む  
- このリポジトリで管理され全ての設定が一元化  

### 権限管理  
**重要**: Claude Codeがツールやファイルアクセスの権限を要求する場合：  

**権限追加プロセス:**  
1. 権限を求められたら許可する  
2. **全ての権限**を `claude/settings.json` の `permissions.allow` 配列に追加  
   - プロジェクト関連権限（リポジトリ固有のツールとワークフロー）  
   - グローバル権限（個人設定, システム全体のツール）  
3. **重要**: `.claude/settings.local.json` に自動追加された権限は削除し `claude/settings.json` に移動  

**利点**: シンボリックリンク構造により一つのファイルで全ての設定を管理でき gitによるバージョン管理と同期が可能  

## 📚 追加リソース  

### 実装ガイド  
**重要**: VimまたはZsh実装作業時はこれらの環境変数で指定された関連実装ガイドファイルを必ず読んでください：  

- `$MARKDOWN_TEXTS_VIM_IMPLEMENTATION_GUIDE_FILE_PATH` - Vim実装のベストプラクティスとガイドライン  
- `$MARKDOWN_TEXTS_ZSH_IMPLEMENTATION_GUIDE_FILE_PATH` - Zsh関数実装のベストプラクティスとガイドライン  

**使用方法:**  
- これらのガイドには重要な実装パターンとベストプラクティスが含まれています  
- VimプラグインやZsh関数を実装する前に必ずこれらのガイドを参照してください  
- これらのファイルの内容はCLAUDE.mdの指示と同じくらい重要です  

## 🔄 ルール進化プロセス  

**重要**: ユーザーが永続的な標準となるべき指示を提供した場合：  

1. **認識フェーズ**: ユーザーの指示が一回限りの要求ではなく継続的な要件である場合を特定  
   - ワークフローパターンに影響する指示  
   - 将来の全てのやり取りに適用すべき設定  
   - プロジェクト全体の一貫性を向上させる標準  

2. **確認フェーズ**: ユーザーに明示的に質問：  
   ```  
   "これを将来の全てのやり取りにおける永続的なルールにしますか？"  
   ```  

3. **実装フェーズ**: ユーザーの確認（YES）時：  
   - 新しいルールをこのCLAUDE.mdファイルの適切なセクションに追加  
   - ルールを即座に適用し以降の全てのやり取りで使用  
   - 必要に応じて具体例を含めてルールを明確に文書化  

4. **適用フェーズ**:  
   - 文書化された全てのルールを必須要件として扱う  
   - 全てのやり取りでルールを一貫して参照  
   - 明示的なユーザー指示なしに確立されたルールを無視または上書きしない  

**目的**: このプロセスはユーザー設定を体系的に取得し永続的なプロジェクト標準に変換することで AIエージェントのパフォーマンスの継続的改善を保証します  

## 📝 重要事項  

- 全てのインストールスクリプトは環境変数用に `scripts/env.bash` をソース  
- リポジトリはHomebrew統合でmacOS (Darwin) 用に設計  
- ローカルカスタマイゼーションは `.local` で終わるファイルに配置  
- システムは作業ディレクトリを作成: `~/works/`, `~/log/`, `~/.cache/` 等  
- `~/works/memolist/` での一時ファイルとタスク管理用のMemolistシステム  

## 📋 重要指示リマインダー  
求められたことを実行する；それ以上でも以下でもない  
絶対に必要でない限りファイルを作成しない  
新しいファイルを作成するよりも既存ファイルの編集を常に優先する  
ドキュメントファイル（*.md）やREADMEファイルを積極的に作成しない  
ユーザーが明示的に要求した場合のみドキュメントファイルを作成する  
